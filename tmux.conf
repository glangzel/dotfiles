# ==========================================
# 1. 基本設定 (Basic Settings)
# ==========================================

# プレフィックスキーを 'Ctrl-b' から 'Ctrl-q' に変更
# (Vimで Ctrl-b をページバックに使うため、衝突を避けるのにも便利です)
unbind C-b
set -g prefix C-q
bind C-q send-prefix

# マウス操作を有効化 (パネルのサイズ変更や選択が可能になります)
set-option -g mouse on

# 256色モードを有効化
set -g default-terminal "tmux-256color"
# NeoVim等のTrueColor表示のために必要 (色が正しく表示されない場合の対策)
set -ag terminal-overrides ",xterm-256color:RGB"

# ウィンドウとペインの番号を 1 から開始 (デフォルトは0ですが、キーボードの配置的に1が押しやすいため)
set -g base-index 1
setw -g pane-base-index 1

# ウィンドウを閉じた際に番号を詰める
set -g renumber-windows on

# コピーモード設定
set-window-option -g mode-keys vi
bind -T copy-mode-vi v send-keys -X begin-selection

# ==========================================
# 2. キーバインド (Key Bindings)
# ==========================================

# 設定ファイルの再読み込み: Prefix + r
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# --- ウィンドウ分割の直感的なキーバインド ---
# Prefix + | で左右に分割
bind | split-window -h -c "#{pane_current_path}"
# Prefix + - で上下に分割
bind - split-window -v -c "#{pane_current_path}"
# ※ -c "#{pane_current_path}" は、新しいパネルを現在と同じディレクトリで開く設定です

# --- Vimライクなペイン移動 ---
# Prefix + h/j/k/l で移動
bind -r h select-pane -L 
bind -r j select-pane -D 
bind -r k select-pane -U 
bind -r l select-pane -R

# --- パネルサイズ調整 (Alt + 矢印キー) ---
# Prefixを押さずに Alt + 矢印キー でリサイズ
bind-key -n M-Up    select-pane -L
bind-key -n M-Down  select-pane -D
bind-key -n M-Left  select-pane -U
bind-key -n M-Right select-pane -R
# bind-key -n M-Up resize-pane -U 3
# bind-key -n M-Down resize-pane -D 3
# bind-key -n M-Left resize-pane -L 3
# bind-key -n M-Right resize-pane -R 3

# ==========================================
# 3. コピーモード設定 (Copy Mode)
# ==========================================
# コピーモードのキー操作をViライクにする
set-window-option -g mode-keys vi

# コピーモードへの入り方: Prefix + [
# 選択開始: v
# 行選択: V
# コピー: y
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi V send-keys -X select-line
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy" # macOSの場合
# Linux(xclip)の場合は以下をコメントアウトして有効化
# bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"

# ==========================================
# 4. 外観・テーマ (Appearance & Plugins)
# ==========================================

# 通知設定 (画面がフラッシュするのを防ぐ)
setw -g monitor-activity off
set -g visual-activity off

# ステータスバーの更新頻度 (秒)
set -g status-interval 5


# ==========================================
# ウィンドウ名とプロセス表示の設定
# ==========================================
# ウィンドウ名を自動的に実行中のコマンド名(nvim, bash等)にする
setw -g automatic-rename on

# ウィンドウが閉じたら番号を詰める
set -g renumber-windows on

# ------------------------------------------
# ステータスバーのデザイン (Gruvbox風 & パイプ区切り)
# ------------------------------------------
# ステータスバー全体の更新間隔(秒)
set -g status-interval 1

# ステータスバーの背景色・文字色
set -g status-bg colour235 # Dark Gray
set -g status-fg colour223 # Light

# --- 左側: セッション名 ---
set -g status-left-length 20
set -g status-left "#[bg=colour214,fg=colour235,bold] #S #[bg=colour235,fg=colour214,nobold]|"

# --- 右側: ホスト名 | 日付 ---
set -g status-right-length 50
set -g status-right "#[fg=colour246]| #h | %Y-%m-%d %H:%M "

# --- 中央: ウィンドウリスト (1 | nvim  2 | bash) ---
setw -g window-status-separator ""

# 非アクティブなウィンドウの見た目
# フォーマット: " 番号 | コマンド名 " (色はグレー)
setw -g window-status-format "#[fg=colour246,bg=colour235] #I | #W "

# アクティブなウィンドウの見た目
# フォーマット: " 番号 | コマンド名 " (色はオレンジ背景、黒文字で強調)
setw -g window-status-current-format "#[fg=colour235,bg=colour214,bold] #I | #W #[default]"

# ==========================================
# ペイン境界線の色
# ==========================================
set -g pane-border-fg colour235
set -g pane-active-border-fg colour214

# プラグイン設定
# set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'tmux-plugins/tmux-sensible'

# --- カラースキーム: Gruvbox ---
# DarkモードのGruvboxテーマを適用
# Set -g @plugin 'egel/tmux-gruvbox'
# Set -g @tmux-gruvbox 'dark' # or 'light'

# ==========================================
# 5. プラグインマネージャの初期化 (最下行に記述)
# ==========================================
# run '~/.tmux/plugins/tpm/tpm'
